# Error - Stack

The standard library's `error` implementation is relatively simple and does not allow for stack tracing, which is not very friendly for the upper-level callers when an error occurs, as they cannot obtain detailed information about the error call chain. `gerror` supports error stack recording, methods such as `New/Newf`, `Wrap/Wrapf` will automatically record the stack information when the error occurs.

Example:

```go
package main

import (
    "fmt"
    "github.com/gogf/gf/v2/errors/gerror"
)

func OpenFile() error {
    return gerror.New("permission denied")
}

func OpenConfig() error {
    return gerror.Wrap(OpenFile(), "configuration file opening failed")
}

func ReadConfig() error {
    return gerror.Wrap(OpenConfig(), "reading configuration failed")
}

func main() {
    fmt.Printf("%+v", ReadConfig())
}

```

Output:

```bash
reading configuration failed: configuration file opening failed: permission denied
1. reading configuration failed
    1). main.ReadConfig
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:18
    2). main.main
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:25
2. configuration file opening failed
    1). main.OpenConfig
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:14
    2). main.ReadConfig
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:18
    3). main.main
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:25
3. permission denied
    1). main.OpenFile
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:10
    2). main.OpenConfig
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:14
    3). main.ReadConfig
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:18
    4). main.main
        /Users/goframe/Workspace/Go/GOPATH/src/github.com/gogf/gf/v2/geg/errors/gerror/gerror2.go:25
```

As we can see that the `Wrap` method wrap the underlying `error` stack information hierarchically, and include complete error stack information.

## HasStack

By `HasStack` method, we can determine whether the given `error` interface object implements (contains) stack information.

```go
HasStack(err error) bool
```

Example:

```go
func ExampleHasStack() {
    err1 := errors.New("sql error")
    err2 := gerror.New("write error")
    fmt.Println(gerror.HasStack(err1))
    fmt.Println(gerror.HasStack(err2))

    // Output:
    // false
    // true
}
```

## Stack Information

By `Stack` method, we can obtain the complete stack information of the `error` object, returning a list of stack strings. Note that the parameter is of the standard library `error` type. When this parameter is an `error` generated by the `gerror` module, or when the developer's custom error object implements this interface, it supports printing; otherwise, it returns an empty string.

```go
Stack(err error) string
```

Example:

```go
func ExampleStack() {
    var err error
    err = errors.New("sql error")
    err = gerror.Wrap(err, "adding failed")
    err = gerror.Wrap(err, "api calling failed")
    fmt.Println(gerror.Stack(err))

    // Output:
    // 1. api calling failed
    //     1).  main.main
    //         /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/other/test.go:14
    // 2. adding failed
    //     1).  main.main
    //         /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/other/test.go:13
    // 3. sql error
}
```

## Current

By `Current` method, we can obtain the current `error` object, returning the `error` type.

```go
Current(err error) error
```

Example:

```go
func ExampleCurrent() {
    var err error
    err = errors.New("sql error")
    err = gerror.Wrap(err, "adding failed")
    err = gerror.Wrap(err, "api calling failed")
    fmt.Println(err)
    fmt.Println(gerror.Current(err))

    // Output:
    // api calling failed: adding failed: sql error
    // api calling failed
}
```

## Next and Unwrap

`Next/Unwrap` methods are used to get the next level `error` interface object of a hierarchical error. When the next level does not exist, it returns nil. The `Unwrap` method is an alias for the `Next` method and is the error stack iteration method supported since `Golang version v1.17`.

```go
Next(err error) error
```

Hirarchical error:

```go
func ExampleNext() {
    var err error
    err = errors.New("sql error")
    err = gerror.Wrap(err, "adding failed")
    err = gerror.Wrap(err, "api calling failed")

    fmt.Println(err)

    err = gerror.Next(err)
    fmt.Println(err)

    err = gerror.Next(err)
    fmt.Println(err)

    // Output:
    // api calling failed: adding failed: sql error
    // adding failed: sql error
    // sql error
}
```

Iteration error stack:

```go
func IsGrpcErrorNotFound(err error) bool {
    if err != nil {
        for e := err; e != nil; e = gerror.Unwrap(e) {
            if s, ok := status.FromError(e); ok && s != nil && s.Code() == codes.NotFound {
                return true
            }
        }
    }
    return false
}
```

## Cause

By `Cause` method, we can get the root `error` information (original error) of the error object. Note that the parameter is of the standard library `error` type. When this parameter is an `error` generated by the `gerror` module, or when the custom error `object` implements this interface method, it supports printing; otherwise, it returns the output `error` object itself.

```go
Next(err error) error
```

Example:

```go
package main

import (
   "fmt"
   "github.com/gogf/gf/v2/errors/gerror"
)

func OpenFile() error {
   return gerror.New("permission denied")
}

func OpenConfig() error {
   return gerror.Wrap(OpenFile(), "configuration file opening failed")
}

func ReadConfig() error {
   return gerror.Wrap(OpenConfig(), "reading configuration failed")
}

func main() {
   fmt.Println(gerror.Cause(ReadConfig()))
}

// Output:
// permission denied
```
