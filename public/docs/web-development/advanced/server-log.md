# Service Log Management

The `GoFrame` framework provides comprehensive `server` log management features, including `access logs` and `error logs`. It is recommended to use a configuration file to manage these configurations uniformly.

## Log Configuration

### Configuration Object

Please refer to the API documentation for details:

[ServerConfig API Documentation](https://pkg.go.dev/github.com/gogf/gf/v2/net/ghttp#ServerConfig)

### Configuration Properties

The log-related configuration properties are as follows:

```go
Logger            *glog.Logger      // Logger for server.
LogPath           string            // Directory for storing logging files.
LogStdout         bool              // Printing logging content to stdout.
ErrorStack        bool              // Logging stack information when error.
ErrorLogEnabled   bool              // Enable error logging files.
ErrorLogPattern   string            // Error log file pattern like: error-{Ymd}.log
AccessLogEnabled  bool              // Enable access logging files.
AccessLogPattern  string            // Error log file pattern like: access-{Ymd}.log
```

***Brief Explanation***

- By default, logs are not output to a file but are printed directly to the terminal. The default `access log` terminal output is turned off, while the `error log` is enabled by default.

- All options can be set through the `Server.Set*` methods, and most options can be retrieved through the `Server.Get*` methods.

- The `Logger` is a custom log management object. Developers can also pass a complete log management object, ignoring other log option configurations.

- The `LogPath` property is used to set the log directory, and logs will only be output to log files if the log directory is set.

- `ErrorLogPattern` and `AccessLogPattern` are used to configure the log file name format, with default values of `error-{Ymd}.log` and `access-{Ymd}.log`, respectively. For example: `error-20191212.log`, `access-20191212.log`.

- Please refer to the comments and API documentation for explanations of other configuration options.

### Configuration File

The official recommendation is to use a configuration file to manage service configurations and log configurations. Here is an example of a log configuration (using `YAML` format as an example):

```yaml
server:
  LogPath: "/var/log/gf-demos/server"
  LogStdout: false
  ErrorStack: true
  ErrorLogEnabled: true
  ErrorLogPattern: "error.{Ymd}.log"
  AccessLogEnabled: true
  AccessLogPattern: "access.{Ymd}.log"
```

When the Server starts, it will automatically read the configuration from the default configuration file `config.yaml` under the `server` node.

### Configuration Methods

Log configurations can also be made through the `Server` object's `Set*` methods. Please refer to the [Service Configuration](/docs/web-development/server-config) section for details.

## Log Format

The configuration file method is relatively simple, so no further examples are provided here. The following example demonstrates how to configure the `Server` through configuration methods.

### Request Log

Request log example:

```bash
2018-04-20 18:11:57.344 200 "GET http 127.0.0.1:8199 /log/access HTTP/1.1" 0.120, 127.0.0.1, "", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/53.0.2785.143 Chrome/53.0.2785.143 Safari/537.36"
```

Log format:

- Request time (accurate to milliseconds)
- HTTP status code
- "Request method Request scheme Request host Request URI Request protocol"
- Execution time (seconds)
- Client IP
- Referer URL
- UserAgent

The request scheme is either `http` or `https`, and the request protocol is often `HTTP/1.0` or `HTTP/1.1`.

> Please note that the execution time recorded in the logs is in seconds, and in most cases, the time seen is almost 0.xxx seconds, meaning the execution time is at the millisecond level, less than 1 second.

### Error Log

Error log example:

```bash
2019-12-20 20:10:56.484 [ERRO] 500, "GET http 127.0.0.1:8199 /log/error HTTP/1.1" 0.210, 127.0.0.1, "", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36"
Stack:
1. OMG
   1). main.main.func1
        /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/net/ghttp/server/log/log_error.go:10
```

Error messages will print the corresponding error stack information (the stack information does not include internal framework call information) to facilitate error location and analysis of the cause by developers.

> Any `panic` errors generated by the `Server` will be automatically captured in the error logs. Therefore, for business-side programs, whether in controllers, business encapsulation layers, or data models, if an error occurs that wants to directly exit the business request processing, simply `panic`.

## Custom Log Handling

Developers can customize the handling of `Server` request logs in two ways:

1. Pass a custom `*glog.Logger` object through the log configuration item.
2. Use middleware to uniformly capture and process, refer to the [Route Management - Interceptors](/docs/web-development/router/interceptor/) section.

## Server Logs vs. Business Logs

This is a `FAQ`.

It is important to note that the logs mentioned here are `Server` logs, similar to the logs of `web server` services like `nginx`, `apache`, `tomcat`, etc. They only allow the `Server` to output content; developers cannot write log content to the `Server`'s log files. Moreover, the log types and formats are completely fixed.

The `GoFrame` framework also provides a log module implemented by the `glog` log component. The logs printed by developers through the `glog` component are business logs. The program business code can decide what content to output, where to output, and what the output format is. The common method `g.Log()` is used to output business logs, which supports automatically reading the `logger` configuration items in the configuration file. Please refer to the [Log Component](/docs/core-component/log/) section for details.
