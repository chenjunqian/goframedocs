# API Documentation - OpenAPIv3

The OpenAPIv3 protocol is primarily used in standard routing. Before reading the introduction to the API documentation protocol, please familiarize yourself with standard routing: [Standard Router](/docs/web-development/router/registry/standard).

## OpenAPIv3

For a detailed introduction to the `OpenAPIv3` protocol, please refer to: [OpenAPI Specification](https://swagger.io/specification/).

## g.Meta Metadata

The metadata information of an interface can be `embedded` in the input structure by using the `embedded` method of the `g.Meta` structure. This is achieved through the attribute label of `g.Meta`.

For more information about the metadata component, please refer to the section: [Metadata - gmeta](/docs/component-list/utils/meta).

## Common Protocol Tags

The attribute tags of input and output structures fully support the `OpenAPIv3` protocol. Therefore, as long as the corresponding protocol tags are added, the generated `OpenAPIv3` interface information will automatically include these attributes.

Most tag attributes are automatically generated by the Server component, and there are not many tags that developers need to set manually.

1. **Basic Tags**
   Common basic tags include:

   - `path`: Combined with the prefix at registration to form the interface URI path. Used for `g.Meta` to identify interface metadata.
   - `tags`: The tag to which the interface belongs, used for interface categorization. Used for `g.Meta` to identify interface metadata.
   - `method`: The request method of the interface: GET/PUT/POST/DELETE... (case-insensitive). Used for `g.Meta` to identify interface metadata.
   - `deprecated`: Marks the interface as deprecated. Used for `g.Meta` to identify interface metadata.
   - `summary`: A brief description of the interface/parameter. Abbreviated as `sm`.
   - `description`: A detailed description of the interface/parameter. Abbreviated as `dc`.
   - `in`: The submission method of the parameter: header/path/query/cookie.
   - `default`: The default value of the parameter. Abbreviated as `d`.
   - `mime`: The MIME type of the interface, e.g., `multipart/form-data` is usually a global setting, and the default is `application/json`. Used for `g.Meta` to identify interface metadata.
   - `type`: The type of the parameter, generally does not need to be set, special parameters need to be set manually, e.g., `file`. Only used for parameter attributes.

   > For more tags, please refer to the standard `OpenAPIv3` protocol: [OpenAPI Specification](https://swagger.io/specification/).

2. **Extended Tags**
   In the `OpenAPI` specification, all tags starting with `x-` are custom extended tags that developers can define. Extended tags can be defined in any interface, attribute in the form of `Golang struct tags`, and will be returned as separate fields when the interface documentation is generated. For example:

   ```go
   package main

   import (
       "context"

       "github.com/gogf/gf/v2/errors/gcode"
       "github.com/gogf/gf/v2/errors/gerror"
       "github.com/gogf/gf/v2/frame/g"
       "github.com/gogf/gf/v2/net/ghttp"
   )

   type GetListReq struct {
       g.Meta `path:"/user" tags:"User" method:"get" x-group:"User/Info" summary:"Get user list with basic info."`
       Page   int `dc:"Page number" d:"1" x-sort:"1"`
       Size   int `dc:"Size for per page." d:"10" x-sort:"2"`
   }
   type GetListRes struct{}

   type Controller struct{}

   func (c *Controller) GetList(ctx context.Context, req *GetListReq) (res *GetListRes, err error) {
       return nil, gerror.NewCode(gcode.CodeNotImplemented)
   }

   func main() {
       s := g.Server()
       s.Group("/", func(group *ghttp.RouterGroup) {
           group.Bind(new(Controller))
       })
       s.SetOpenApiPath("/api.json")
       s.SetSwaggerPath("/swagger")
       s.SetPort(8199)
       s.Run()
   }
   ```

   After execution, visit the address [http://127.0.0.1:8199/swagger](http://127.0.0.1:8199/swagger) to view the `Swagger UI`, and visit [http://127.0.0.1:8199/api.json](http://127.0.0.1:8199/api.json) to view the corresponding `OpenAPIv3` interface documentation. The generated `OpenAPIv3` interface documentation is as follows:

   ```json
   {
       "openapi": "3.0.0",
       "components": {
           "schemas": {
               "main.GetListReq": {
                   "properties": {
                       "Page": {
                           "default": 1,
                           "description": "Page number",
                           "format": "int",
                           "properties": {},
                           "type": "integer",
                           "x-sort": "1"
                       },
                       "Size": {
                           "default": 10,
                           "description": "Size for per page.",
                           "format": "int",
                           "properties": {},
                           "type": "integer",
                           "x-sort": "2"
                       }
                   },
                   "type": "object",
                   "x-group": "User/Info"
               },
               "main.GetListRes": {
                   "properties": {},
                   "type": "object"
               }
           }
       },
       "info": {
           "title": "",
           "version": ""
       },
       "paths": {
           "/user": {
               "get": {
                   "parameters": [
                       {
                           "description": "Page number",
                           "in": "query",
                           "name": "Page",
                           "schema": {
                               "default": 1,
                               "description": "Page number",
                               "format": "int",
                               "properties": {},
                               "type": "integer",
                               "x-sort": "1"
                           },
                           "x-sort": "1"
                       },
                       {
                           "description": "Size for per page.",
                           "in": "query",
                           "name": "Size",
                           "schema": {
                               "default": 10,
                               "description": "Size for per page.",
                               "format": "int",
                               "properties": {},
                               "type": "integer",
                               "x-sort": "2"
                           },
                           "x-sort": "2"
                       }
                   ],
                   "responses": {
                       "200": {
                           "content": {
                               "application/json": {
                                   "schema": {
                                       "$ref": "#/components/schemas/main.GetListRes"
                                   }
                               }
                           },
                           "description": ""
                       }
                   },
                   "summary": "Get user list with basic info.",
                   "tags": [
                       "User"
                   ],
                   "x-group": "User/Info"
               },
               "x-group": "User/Info"
           }
       }
   }
   ```

   It can be seen that the extended tags have been generated in the interface documentation.

## Extending OpenAPIv3 Information

The core interface information has been automatically generated. If developers want to further improve the interface information, they can obtain the OpenAPIv3 structure object through the `s.GetOpenApi()` interface and manually fill in the corresponding attribute content. Let's look at an example, in which we design a common outer data structure for each interface:

```go
package app

import (
    "github.com/gogf/gf/v2/frame/g"
    "github.com/gogf/gf/v2/net/ghttp"
)

// Run starts the application
func Run() {
    var (
        ctx = gctx.New()
        s = g.Server()
        oai = s.GetOpenApi() // Get OpenApi object
    )
    
    // Customize OpenApi information
    oai.Info.Title = 'API Reference'
    oai.Config.CommonResponse = response.JsonRes{}
    oai.Config.CommonResponseDataField = "Data"

    // Static directory setting
    uploadPath := g.Cfg().MustGet(ctx, "upload.path").String()
    if uploadPath == "" {
        g.Log().Fatal(ctx, "File upload configuration path cannot be empty")
    }
    s.AddStaticPath("/upload", uploadPath)

    // HOOK, prevent browser caching during development for easier debugging
    if gmode.IsDevelop() {
        s.BindHookHandler("/*", ghttp.HookBeforeServe, func(r *ghttp.Request) {
            r.Response.Header().Set("Cache-Control", "no-store")
        })
    }

    // Customize error pages for the front-end system
    s.BindStatusHandler(401, func(r *ghttp.Request) {
        if strings.HasPrefix(r.URL.Path, "/admin") {
            // Handle 401 status for admin routes
        }
    })

    ...
}
```

> We can see that through the common `OpenAPIv3` object, we can customize and modify its content, and generate various types of custom interface documentation based on it.
